# .github/workflows/cicd.yaml
name: Go Service CI/CD - manual trigger

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual trigger'
        required: false
        default: 'Manual execution'
        type: string

jobs:
  go-test-build:
    #runs-on: arc-default-ub22-xs-set 
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Display environment info
        run: |
          echo "========================================"
          echo "Starting CI/CD Pipeline"
          echo "========================================"
          echo "Trigger: ${{ github.event_name }}"
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "Manual Trigger Reason: ${{ github.event.inputs.reason }}"
          fi
          if [ "${{ github.event_name }}" = "schedule" ]; then
            echo "Scheduled Run"
          fi
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"
          echo "Repository: ${{ github.repository }}"
          echo "========================================"

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.23'
          
      - name: Verify Go installation
        run: |
          echo "========================================"
          echo "Go Setup Completed"
          echo "========================================"
          go version
          echo "GOPATH: $GOPATH"
          echo "GOROOT: $GOROOT"
          echo "========================================"   

      - name: Run tests
        run: |
          echo "========================================"
          echo "Starting Test Execution"
          echo "========================================"
          go test -v ./...
          echo "========================================"
          echo "✓ Tests completed successfully"
          echo "========================================"

      - name: Build
        run: |
          echo "========================================"
          echo "Starting Build Process"
          echo "========================================"
          go build -v ./...
          echo "========================================"
          echo "✓ Build completed successfully"
          echo "========================================"
          
      - name: Pipeline Summary
        run: |
          echo "========================================"
          echo "CI/CD Pipeline Completed Successfully"
          echo "========================================"
          echo "All steps passed:"
          echo "  ✓ Code checkout"
          echo "  ✓ Go setup"
          echo "  ✓ Tests"
          echo "  ✓ Build"
          echo "========================================"